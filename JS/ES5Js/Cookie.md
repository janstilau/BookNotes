# Cookie
阮一峰的Cookie主要讲了Cookie的属性和用法, 但是这个东西做什么的没有讲. 

https://zhuanlan.zhihu.com/p/27669892 --> 认识HTTP----Cookie和Session篇


## Cookie是什么
1. Cookie 是浏览器访问服务器后，服务器传给浏览器的一段数据。

2. 浏览器需要保存这段数据，不得轻易删除。

3. 此后每次浏览器访问该服务器，都必须带上这段数据。

这很像是, App用户登录之后, 服务器给app发的sessionId, 以后的每一次操作, 都发送这个sessionId. 

## 如何使用Cookie

Cookie 一般有两个作用。

第一个作用是识别用户身份。

比如用户 A 用浏览器访问了 http://a.com，那么 http://a.com 的服务器就会立刻给 A 返回一段数据「uid=1」（这就是 Cookie）。当 A 再次访问 http://a.com 的其他页面时，就会附带上「uid=1」这段数据。

同理，用户 B 用浏览器访问 http://a.com 时，http://a.com 发现 B 没有附带 uid 数据，就给 B 分配了一个新的 uid，为2，然后返回给 B 一段数据「uid=2」。B 之后访问 http://a.com 的时候，就会一直带上「uid=2」这段数据。

借此，http://a.com 的服务器就能区分 A 和 B 两个用户了。

第二个作用是记录历史。

假设 http://a.com 是一个购物网站，当 A 在上面将商品 A1 、A2 加入购物车时，JS 可以改写 Cookie，改为「uid=1; cart=A1,A2」，表示购物车里有 A1 和 A2 两样商品了。
这样一来，当用户关闭网页，过三天再打开网页的时候，依然可以看到 A1、A2 躺在购物车里，因为浏览器并不会无缘无故地删除这个 Cookie。
借此，就达到里记录用户操作历史的目的了

第三个也可以记录用户账号密码

第一次登陆成功后，给你的电脑发送一个存有你用户名的Cookie。于是，在Cookie失效之前，你每一次登陆服务器，服务器都会直接读取你的Cookie中的用户名，然后返回给你一个登陆成功的页面。挺危险的是吧，所以通常会有一些加密手段以及借助Session的帮助。


Cookie的工作机制是用户识别和状态管理. Web网站为了管理用户的状态, 会通过web浏览器, 把一些数据临时写入用户的计算机内. 接着, 当用户访问该web网站的时候, 可以通过通信的方式取回之前发放的Cookie. 

## Cookie的属性
1. String「name」 ：该Cookie的「名称」。Cookie一旦创建，名称便不可更改。

2. Object「value」：该Cookie的「值」

3. Int「maxAge」：该Cookie的「失效时间」，单位秒

注：如果为正数，则该Cookie在maxAge秒后失效。如果为负数，则该Cookie为临时Cookie，关闭浏览器即失效。如果为0，表示删除该Cookie。默认为-1，即关闭浏览器即失效
4. Boolean「secure」：「是否仅使用安全协议传输」，默认为false

5. String「path」：该Cookie的「使用路径」

注：如果设置为“/shit/”，则只有“http:http://xxx.xxx.xxx/shit”的程序可以访问该Cookie。如果设置为“/”，则本域名下的程序都可以访问Cookie，注意最后一个字符必须为“/”。
6. String「domain」：「可以访问该Cookie的域名」。

注：如果设置为".http://google.com"，则所有以"http://google.com"结尾的域名都可以访问该Cookie。注意第一个字符必须为“.”。
7. String「comment」：该Cookie的「用处说明」，用来再浏览器显示Cookie信息的时候显示该说明。

8. Int「version」：该Cookie的「版本号」。0表示遵循Netspace的Cookie规范，1表示遵循W3C的RFC2109规范。

## 修改删除
修改：创建同名Cookie，覆盖原来的Cookie
删除：创建同名Cookie，并将maxAge属性设置为0

## Session是什么
Session是「你去理发店办卡后，店家记录你剩余次数的那个大本子」。它保存在服务器端，不负责记录你还能剪几次，但是它会把客户端的某种信息保存在服务器上。当客户端下一次来访问时，根据信息确定客户身份即可。



## Cookie和session的区别
1. 由于HTTP协议是无状态的协议，所以服务端需要记录用户的状态时，就需要用某种机制来识具体的用户，这个机制就是Session.典型的场景比如购物车，当你点击下单按钮时，由于HTTP协议无状态，所以并不知道是哪个用户操作的，所以服务端要为特定的用户创建了特定的Session，用于标识这个用户，并且跟踪用户，这样才知道购物车里面有几本书。这个Session是保存在服务端的，有一个唯一标识。在服务端保存Session的方法很多，内存、数据库、文件都有。集群的时候也要考虑Session的转移，在大型的网站，一般会有专门的Session服务器集群，用来保存用户会话，这个时候 Session 信息都是放在内存的，使用一些缓存服务比如Memcached之类的来放 Session。

2. 思考一下服务端如何识别特定的客户？这个时候Cookie就登场了。每次HTTP请求的时候，客户端都会发送相应的Cookie信息到服务端。实际上大多数的应用都是用 Cookie 来实现Session跟踪的，第一次创建Session的时候，服务端会在HTTP协议中告诉客户端，需要在 Cookie 里面记录一个Session ID，以后每次请求把这个会话ID发送到服务器，我就知道你是谁了。有人问，如果客户端的浏览器禁用了 Cookie 怎么办？一般这种情况下，会使用一种叫做URL重写的技术来进行会话跟踪，即每次HTTP交互，URL后面都会被附加上一个诸如 sid=xxxxx 这样的参数，服务端据此来识别用户。

3. Cookie其实还可以用在一些方便用户的场景下，设想你某次登陆过一个网站，下次登录的时候不想再次输入账号了，怎么办？这个信息可以写到Cookie里面，访问网站的时候，网站页面的脚本可以读取这个信息，就自动帮你把用户名给填了，能够方便一下用户。这也是Cookie名称的由来，给用户的一点甜头。

所以，总结一下：
Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；
Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。














